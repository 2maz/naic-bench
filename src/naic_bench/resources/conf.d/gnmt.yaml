pytorch:
  gnmt:
    repo: 
      url: https://github.com/2maz/naic-DeepLearningExamples.git
    prepare:
      data: gnmt.prepare
    command: >
      python -m torch.distributed.run --nproc_per_node={{GPU_COUNT}} train.py
    metrics:
      throughput:
        pattern: "^.*Training:.*$"
        split_by: ' '
        match_group_index: 4
    variants:
      fp32:
        base_dir: PyTorch/Translation/GNMT
        batch_size:
          size_1gb: 8
          multiple_pu_scaling_factor: 0.7
          apply_via: --train-batch-size
        arguments:
          dataset-dir: "{{DATA_DIR}}/gnmt/wmt16_de_en"
          math: fp32
          epochs: 2
          seed: 2
          train-loader-workers: 32
          save-dir: "{{TMP_DIR}}"
      fp16:
        base_dir: PyTorch/Translation/GNMT
        batch_size:
          size_1gb: 16
          multiple_gpu_scaling_factor: 0.7
          apply_via: --train-batch-size
        arguments:
          dataset-dir: "{{DATA_DIR}}/gnmt/wmt16_de_en"
          math: fp16
          epochs: 2
          seed: 2
          train-loader-workers: 32
          save-dir: "{{TMP_DIR}}"
